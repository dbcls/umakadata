.row
  .col-xs-12.col-sm-12
  h2.page-header
    | Logs
  '

  - if @log.is_a?(Hash)
      table.table.table-bordered
        thead
          tr
            th.col-xs-5.col-sm-4.col-md-3
              | Name
            th
              | Value
        tbody
         = render partial: 'endpoints/row', locals: {key: nil, content: @log, id: 1, parent_id: nil}
  - else
    p.h3
      | Error
    p.h4 = @log

javascript:
  $(function(){
    $(".table").treetable({ expandable: true });
    elements = $("tbody").children();
    elements.each(function () {
      if ($(this).attr('class').match(/branch/)) {
        id = $(this).attr('data-tt-id');
        if (id.match(/^\d+(_\d+){0,1}$/)) {
          $(".table").treetable('expandNode', id);
        }
      }
    });

    let JSON_REGEXP = /^[\{|\[](.*)\{|\[$/;
    let XML_REGEXP = /^<\?xml(.*)>/;
    $("tr td:first-child").each(function(i, bodyKey) {
      if (!$(bodyKey).text().match(/body/)) {
        return;
      }
      var formattedText = "";
      try {
        var bodyValue = $(bodyKey).next();
        var text = bodyValue.text().trim();
        if (text.match(JSON_REGEXP)) {
          var json = JSON.stringify(JSON.parse(text), null, "    ");
          formattedText = formatText(json);
        } else if (text.match(XML_REGEXP)) {
          var parser = new DOMParser();
          var xmlDocument = parser.parseFromString(text, "text/xml");
          var serializer = new XMLSerializer();
          var xml = serializer.serializeToString(xmlDocument);
          formattedText = formatText(xml);
        } else {
          formattedText = formatText(text);
        }
        bodyValue.empty().append(formattedText);
      } catch (e) {
        formattedText = formatText(text);
        bodyValue.empty().append(formattedText);
      }
    });

    function sanitize(text) {
      return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    function formatText(text) {
      return sanitize(text).replace(/[\n\r|\n|\r]/g, "<br/>").replace(/\t/, "&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\s/g, "&nbsp;")
    }

  });
